<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NotesForge â€” Campus Notes Marketplace</title>
  <meta name="description" content="NotesForge - Campus-wide notes marketplace (prototype UI)" />
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <style>
    /* ========== NOTESFORGE UI: Styles ========== */
    :root{
      --bg: #0f1724;
      --card: rgba(255,255,255,0.04);
      --muted: #9aa6b2;
      --accent: linear-gradient(90deg,#7C3AED,#06B6D4);
      --glass: rgba(255,255,255,0.04);
      --surface: #0b1220;
      --success: #16a34a;
      --danger: #ef4444;
      --shadow: 0 6px 20px rgba(2,6,23,0.6);
      --radius: 14px;
      --glass-border: rgba(255,255,255,0.06);
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent 6%),
        radial-gradient(800px 400px at 90% 80%, rgba(6,182,212,0.07), transparent 6%),
        var(--bg);
      color:#e6eef6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
      transition:background .3s linear, color .2s linear;
    }

    /* Container */
    .container{max-width:1200px;margin:0 auto;gap:24px;display:grid;grid-template-columns:1fr;align-items:start}

    /* NAV */
    nav{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
      border:1px solid var(--glass-border);
      padding:12px 18px;border-radius:12px;box-shadow:var(--shadow);
      backdrop-filter: blur(6px);
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:44px;height:44px;border-radius:10px;background:var(--accent);
      display:flex;align-items:center;justify-content:center;font-weight:700;color:white;
      box-shadow: 0 6px 18px rgba(12,12,20,0.5);
    }
    nav .nav-actions{display:flex;align-items:center;gap:12px}
    .search{
      display:flex;align-items:center;background:var(--card);padding:8px 10px;border-radius:10px;gap:8px;
      min-width:320px;max-width:520px;
    }
    .search input{
      background:transparent;border:0;outline:0;color:inherit;font-size:14px;width:100%;
    }
    .btn{
      border:0;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;
      background:linear-gradient(90deg,#7C3AED,#06B6D4); color:white;box-shadow:0 6px 18px rgba(7,10,20,0.5)
    }
    .icon-btn{background:transparent;border:0;color:var(--muted);padding:8px;border-radius:10px;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}

    /* HERO */
    .hero{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:18px}
    .hero-card{
      padding:26px;border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid var(--glass-border);box-shadow:var(--shadow);backdrop-filter: blur(4px);
    }
    .hero h1{margin:0;font-size:28px;line-height:1.05}
    .hero p{margin:12px 0 18px;color:var(--muted)}
    .quick-features{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .chip{padding:8px 10px;border-radius:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);font-size:13px}

    /* RIGHT PANEL: Wallet + Upload */
    .side-panel{display:flex;flex-direction:column;gap:12px}
    .wallet{
      padding:14px;border-radius:12px;background:linear-gradient(90deg,#041024, rgba(255,255,255,0.01));
      border:1px solid var(--glass-border)
    }
    .wallet h3{margin:0;font-size:14px}
    .balance{font-size:22px;margin-top:8px;font-weight:700}

    /* CATALOG FILTERS + GRID */
    .controls{display:flex;gap:12px;align-items:center;margin-top:18px}
    .select, .input-sm{padding:8px 10px;border-radius:10px;border:1px solid var(--glass-border);background:transparent;color:inherit}
    .catalog{margin-top:18px;display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}

    /* NOTE CARD */
    .note-card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;padding:12px;border:1px solid var(--glass-border);display:flex;flex-direction:column;gap:10px;
      transition:transform .18s ease, box-shadow .18s ease;
    }
    .note-card:hover{transform:translateY(-6px);box-shadow:0 18px 30px rgba(2,6,23,0.6)}
    .note-thumb{height:140px;border-radius:8px;background:linear-gradient(180deg, #091127, #07101a);display:flex;align-items:center;justify-content:center;font-weight:700}
    .note-meta{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .note-title{font-weight:700}
    .note-sub{color:var(--muted);font-size:13px}

    /* MODALS */
    .modal-backdrop{
      position:fixed;inset:0;background:linear-gradient(0deg, rgba(2,6,23,0.6), rgba(2,6,23,0.6));
      display:none;align-items:center;justify-content:center;padding:24px;z-index:80;
    }
    .modal{
      width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;padding:18px;border:1px solid var(--glass-border);
      box-shadow: 0 30px 60px rgba(2,6,23,0.7);backdrop-filter: blur(6px);
    }
    .flex{display:flex;gap:12px;align-items:center}
    .grow{flex:1}

    /* Upload area */
    .drop-area{height:150px;border:2px dashed rgba(255,255,255,0.04);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;color:var(--muted)}
    .preview-grid{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}

    /* Cart / bottom floating actions */
    .floating-cart{
      position:fixed;right:22px;bottom:24px;background:linear-gradient(90deg,#06b6d4,#7c3aed);padding:12px 16px;border-radius:12px;color:white;font-weight:700;box-shadow:0 18px 36px rgba(5,10,20,0.6);cursor:pointer;z-index:60;
    }

    /* FOOTER */
    footer{margin-top:32px;color:var(--muted);font-size:13px;text-align:center}

    /* RESPONSIVE */
    @media (max-width:920px){
      .hero{grid-template-columns:1fr}
      .search{min-width:180px}
      .side-panel{order:2}
    }
    @media (max-width:560px){
      body{padding:16px}
      .search{display:none}
    }

    /* Small utilities */
    .badge{padding:6px 8px;border-radius:10px;background:rgba(255,255,255,0.03);font-weight:600;font-size:12px}
    .price{font-weight:700}
    .muted-2{color:#98a6b6;font-size:12px}
    .tag{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px}
    .center{text-align:center}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="container">
    <nav>
      <div class="brand">
        <div class="logo">NF</div>
        <div>
          <div style="font-weight:800">NotesForge</div>
          <div class="muted" style="font-size:12px">Campus notes. Made by students, for students.</div>
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center">
        <div class="search" title="Search notes by title, topic or author">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path stroke="#9aa6b2" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35"/><circle cx="11" cy="11" r="6" stroke="#9aa6b2" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="globalSearch" placeholder="Search notes, topics, author..." />
          <button class="icon-btn" id="clearSearch" title="Clear search" aria-label="Clear search">âœ•</button>
        </div>

        <div class="nav-actions">
          <button class="icon-btn" id="darkToggle" title="Toggle dark mode">ðŸŒ™</button>
          <button class="btn" id="openUpload">Upload Notes</button>
        </div>
      </div>
    </nav>

    <main style="display:grid;grid-template-columns:1fr;gap:18px">
      <section class="hero-card hero">
        <div>
          <h1>Find, Preview & Buy notes from your campus community</h1>
          <p>Fast previews, per-page purchases, wallet cashback, and reputation for makers. Works for MST, final exams, and quick revision notes.</p>

          <div class="quick-features">
            <div class="chip">Instant preview</div>
            <div class="chip">Per-page buy</div>
            <div class="chip">Secure payments</div>
            <div class="chip">Maker reputation</div>
          </div>

          <div class="controls" style="margin-top:18px">
            <select id="filterCourse" class="select">
              <option value="">All Courses</option>
              <option>DBMS</option><option>COA</option><option>DSA</option><option>Microcontrollers</option>
            </select>
            <select id="sortBy" class="select">
              <option value="new">Newest</option>
              <option value="price-asc">Price â†‘</option>
              <option value="price-desc">Price â†“</option>
              <option value="rating">Top rated</option>
            </select>

            <input id="minPrice" class="input-sm" type="number" placeholder="Min â‚¹" style="width:86px" />
            <input id="maxPrice" class="input-sm" type="number" placeholder="Max â‚¹" style="width:86px" />

            <div style="margin-left:auto" class="muted">Showing <span id="count">0</span> notes</div>
          </div>

          <div id="catalog" class="catalog" aria-live="polite">
            <!-- notes injected by JS -->
          </div>
        </div>

        <aside class="side-panel">
          <div class="wallet">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="muted">Campus Wallet</div>
                <div class="balance" id="walletBalance">â‚¹ 120</div>
                <div class="muted" style="font-size:12px">Cashback available: â‚¹10</div>
              </div>
              <div style="text-align:right">
                <button class="btn" id="addFunds">Add â‚¹100</button>
              </div>
            </div>
          </div>

          <div class="hero-card" style="padding:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">Quick Actions</div>
                <div class="muted" style="font-size:12px">Upload, manage and preview notes</div>
              </div>
              <div>
                <button class="icon-btn" id="openProfile">ðŸ‘©</button>
              </div>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
              <button class="chip" id="myUploadsBtn">My Uploads</button>
              <button class="chip" id="ordersBtn">Orders</button>
              <button class="chip" id="walletBtn">Wallet</button>
            </div>
          </div>

          <div style="padding:12px;border-radius:12px;border:1px solid var(--glass-border);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)">
            <div style="font-weight:700">Top Makers</div>
            <div class="muted" style="font-size:13px;margin-top:8px">See whoâ€™s contributing best content in your courses</div>
            <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
              <div class="tag">Aman â€¢ 4.9</div>
              <div class="tag">Priya â€¢ 4.8</div>
              <div class="tag">CS Batch â€¢ 4.7</div>
            </div>
          </div>
        </aside>
      </section>

      <div style="display:flex;align-items:center;gap:12px">
        <div class="muted">Filters saved locally â€¢ Fast browsing</div>
        <div style="margin-left:auto" class="muted">Protip: click a card to preview pages</div>
      </div>

      <footer>
        Â© NotesForge CU â€” prototype UI â€¢ Built for Chandigarh University students
      </footer>
    </main>
  </div>

  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="modalTitle">Preview</h3>
        <div style="display:flex;gap:8px">
          <button class="icon-btn" id="modalClose">âœ•</button>
        </div>
      </div>

      <div id="modalContent" style="margin-top:12px">
        <!-- preview content injected -->
        <div id="previewArea" class="flex" style="gap:12px"></div>
      </div>
    </div>
  </div>

  <!-- Upload modal (reused) -->
  <div id="uploadBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Upload Notes</h3>
        <button class="icon-btn" id="uploadClose">âœ•</button>
      </div>

      <div style="margin-top:12px">
        <div style="display:flex;gap:16px;align-items:start">
          <div style="flex:1">
            <div class="drop-area" id="dropArea">
              <div style="font-weight:700">Drag & drop files here</div>
              <div class="muted">PDF or images (max 15MB). First 4 pages auto-previewed.</div>
              <input id="fileInput" type="file" accept="application/pdf,image/*" multiple class="hidden" />
              <button class="btn" id="chooseFiles">Choose</button>
            </div>

            <div class="preview-grid" id="filePreview"></div>
          </div>

          <div style="width:320px">
            <label class="muted-2">Title</label>
            <input id="uploadTitle" class="input-sm" placeholder="Title of notes" style="width:100%;margin-top:6px" />
            <label class="muted-2" style="margin-top:8px">Course</label>
            <select id="uploadCourse" class="select" style="width:100%;margin-top:6px">
              <option>DBMS</option><option>DSA</option><option>COA</option><option>Microcontrollers</option>
            </select>
            <label class="muted-2" style="margin-top:8px">Price (â‚¹ per page)</label>
            <input id="uploadPrice" type="number" class="input-sm" value="10" style="width:100%;margin-top:6px" />
            <div style="margin-top:12px;display:flex;gap:8px">
              <button class="btn" id="submitUpload">Publish</button>
              <button class="icon-btn" id="discardUpload">Discard</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="cartBtn" class="floating-cart" title="Open cart">Cart â€¢ <span id="cartCount">0</span> â€¢ â‚¹<span id="cartTotal">0</span></div>

<script>
/* ========== NOTESFORGE UI: Script ========== */
/* Data: sample notes (replace with API data) */
const notesData = [
  {
    id: 'n1', title: 'DBMS Quick Revision', course: 'DBMS', pages: 24, price: 5, rating: 4.9, author: 'Aman', date: '2025-08-10',
    thumbColor: '#0ea5a4', description: 'Concise DBMS notes for MSTs and finals. Includes diagrams and sample queries.'
  },
  {
    id: 'n2', title: 'COA Concepts', course: 'COA', pages: 30, price: 8, rating: 4.7, author: 'Priya', date: '2025-07-12',
    thumbColor: '#7c3aed', description: 'Detailed lecture-wise COA notes with flowcharts and solved examples.'
  },
  {
    id: 'n3', title: 'DSA Essentials', course: 'DSA', pages: 12, price: 10, rating: 4.6, author: 'CS Batch', date: '2025-06-01',
    thumbColor: '#ef4444', description: 'Short DSA techniques and patternsâ€”ideal for quick practice.'
  },
  {
    id: 'n4', title: 'Microcontrollers Lab Notes', course: 'Microcontrollers', pages: 18, price: 6, rating: 4.8, author: 'Ravi', date: '2025-09-01',
    thumbColor: '#06b6d4', description: 'Lab experiments, circuit diagrams and test cases.'
  }
];

/* State */
let state = {
  notes: [...notesData],
  wallet: 120,
  cart: {},
  dark: true,
  filters: { q: '', course: '', minPrice: null, maxPrice: null, sort: 'new' }
};

/* Elements */
const catalog = document.getElementById('catalog');
const countEl = document.getElementById('count');
const globalSearch = document.getElementById('globalSearch');
const clearSearch = document.getElementById('clearSearch');
const filterCourse = document.getElementById('filterCourse');
const sortBy = document.getElementById('sortBy');
const minPrice = document.getElementById('minPrice');
const maxPrice = document.getElementById('maxPrice');
const walletBalance = document.getElementById('walletBalance');
const cartCount = document.getElementById('cartCount');
const cartTotal = document.getElementById('cartTotal');
const cartBtn = document.getElementById('cartBtn');
const modalBackdrop = document.getElementById('modalBackdrop');
const modalTitle = document.getElementById('modalTitle');
const previewArea = document.getElementById('previewArea');

/* Upload elements */
const openUpload = document.getElementById('openUpload');
const uploadBackdrop = document.getElementById('uploadBackdrop');
const uploadClose = document.getElementById('uploadClose');
const dropArea = document.getElementById('dropArea');
const chooseFiles = document.getElementById('chooseFiles');
const fileInput = document.getElementById('fileInput');
const filePreview = document.getElementById('filePreview');
const submitUpload = document.getElementById('submitUpload');
const uploadTitle = document.getElementById('uploadTitle');
const uploadCourse = document.getElementById('uploadCourse');
const uploadPrice = document.getElementById('uploadPrice');
const discardUpload = document.getElementById('discardUpload');

/* Persist simple state */
function saveLocal(){
  localStorage.setItem('nf_wallet', state.wallet);
  localStorage.setItem('nf_cart', JSON.stringify(state.cart));
  localStorage.setItem('nf_filters', JSON.stringify(state.filters));
}
function loadLocal(){
  const w = localStorage.getItem('nf_wallet');
  const c = localStorage.getItem('nf_cart');
  const f = localStorage.getItem('nf_filters');
  if(w) state.wallet = Number(w);
  if(c) state.cart = JSON.parse(c);
  if(f) state.filters = JSON.parse(f);
}
loadLocal();

/* Render */
function renderCatalog(){
  // filter
  let list = [...state.notes];
  const f = state.filters;
  if(f.q) {
    const q = f.q.toLowerCase();
    list = list.filter(n => (n.title + ' ' + n.description + ' ' + n.author + ' ' + n.course).toLowerCase().includes(q));
  }
  if(f.course) list = list.filter(n => n.course === f.course);
  if(f.minPrice) list = list.filter(n => n.price >= Number(f.minPrice));
  if(f.maxPrice) list = list.filter(n => n.price <= Number(f.maxPrice));

  // sort
  if(f.sort === 'price-asc') list.sort((a,b)=>a.price-b.price);
  else if(f.sort === 'price-desc') list.sort((a,b)=>b.price-a.price);
  else if(f.sort === 'rating') list.sort((a,b)=>b.rating-a.rating);
  else list.sort((a,b)=>new Date(b.date) - new Date(a.date));

  catalog.innerHTML = '';
  list.forEach(n => {
    const card = document.createElement('article');
    card.className = 'note-card';
    card.innerHTML = `
      <div class="note-thumb" style="background:linear-gradient(180deg, ${n.thumbColor}, rgba(2,6,23,0.35)); color:white">
        <div>
          <div style="font-size:18px">${n.course}</div>
          <div class="muted-2">${n.pages} pages â€¢ ${n.author}</div>
        </div>
      </div>
      <div>
        <div class="note-meta">
          <div>
            <div class="note-title">${n.title}</div>
            <div class="note-sub">${n.description}</div>
          </div>
          <div style="text-align:right">
            <div class="price">â‚¹${n.price}/p</div>
            <div class="muted-2">${n.rating} â˜…</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn" data-buy="${n.id}">Buy page</button>
          <button class="icon-btn" data-preview="${n.id}">Preview</button>
          <button class="chip" data-add="${n.id}">Add to cart</button>
        </div>
      </div>
    `;
    catalog.appendChild(card);
  });

  countEl.textContent = list.length;
  updateCartUI();
}

/* UI updates */
function updateWalletUI(){
  walletBalance.textContent = "â‚¹ " + state.wallet;
}
function updateCartUI(){
  const items = Object.values(state.cart);
  const qty = items.reduce((s,i)=>s+i.qty,0);
  const total = items.reduce((s,i)=>s + (i.price * i.qty),0);
  cartCount.textContent = qty;
  cartTotal.textContent = total;
}

/* Interactions */
globalSearch.addEventListener('input', e => {
  state.filters.q = e.target.value;
  saveLocal();
  renderCatalog();
});
clearSearch.addEventListener('click', () => {
  globalSearch.value = '';
  state.filters.q = '';
  saveLocal();
  renderCatalog();
});
filterCourse.addEventListener('change', e => {
  state.filters.course = e.target.value;
  saveLocal();renderCatalog();
});
sortBy.addEventListener('change', e => {
  state.filters.sort = e.target.value; saveLocal(); renderCatalog();
});
minPrice.addEventListener('input', e => { state.filters.minPrice = e.target.value || null; saveLocal(); renderCatalog(); });
maxPrice.addEventListener('input', e => { state.filters.maxPrice = e.target.value || null; saveLocal(); renderCatalog(); });

/* Delegation for catalog clicks */
catalog.addEventListener('click', e => {
  const buy = e.target.closest('[data-buy]');
  const preview = e.target.closest('[data-preview]');
  const add = e.target.closest('[data-add]');
  if(buy){
    openBuyModal(buy.dataset.buy);
  } else if(preview){
    openPreview(preview.dataset.preview);
  } else if(add){
    addToCart(add.dataset.add, 1);
  }
});

function openBuyModal(noteId){
  const note = state.notes.find(n=>n.id===noteId);
  if(!note) return;
  modalTitle.textContent = `Buy single page â€” ${note.title}`;
  previewArea.innerHTML = `
    <div style="flex:1">
      <div class="note-thumb" style="height:260px;background:linear-gradient(180deg, ${note.thumbColor}, rgba(2,6,23,0.35))">Preview page (mock)</div>
      <div style="margin-top:12px">${note.description}</div>
    </div>
    <div style="width:240px">
      <div style="font-weight:800;font-size:20px">â‚¹ ${note.price}</div>
      <div class="muted-2" style="margin-top:8px">${note.pages} pages total â€” author: ${note.author}</div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" id="confirmBuy">Pay & Download</button>
        <button class="icon-btn" id="closeBuy">Cancel</button>
      </div>
    </div>
  `;
  showModal();
  document.getElementById('confirmBuy').addEventListener('click', () => {
    if(state.wallet >= note.price){
      state.wallet -= note.price;
      saveLocal();
      updateWalletUI();
      alert('Purchase complete â€” page unlocked in your orders.');
      hideModal();
    } else {
      alert('Insufficient wallet balance. Add funds and try again.');
    }
  });
  document.getElementById('closeBuy').addEventListener('click', hideModal);
}

function openPreview(noteId){
  const note = state.notes.find(n=>n.id===noteId);
  if(!note) return;
  modalTitle.textContent = `Preview â€” ${note.title}`;
  // mock preview pages
  const pages = Math.min(4, note.pages);
  let html = '<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px">';
  for(let i=1;i<=pages;i++){
    html += `<div style="border-radius:8px;padding:12px;background:rgba(255,255,255,0.02)"><div style="font-weight:700">Page ${i}</div><div class="muted-2" style="margin-top:8px">This is a preview page. Watermarked. Purchase to unlock full content.</div></div>`;
  }
  html += '</div>';
  html += '<div style="margin-top:12px;display:flex;gap:8px"><button class="btn" id="buyAll">Buy full (${note.pages} pages)</button><button class="icon-btn" id="closePreview">Close</button></div>';
  previewArea.innerHTML = html;
  showModal();

  document.getElementById('buyAll').addEventListener('click', () => {
    // simplistic total
    const totalPrice = note.price * note.pages;
    if(state.wallet >= totalPrice){
      state.wallet -= totalPrice; saveLocal(); updateWalletUI();
      alert('Full notes purchased. Check orders.');
      hideModal();
    } else {
      alert('Insufficient funds. Add to wallet or buy per page.');
    }
  });
  document.getElementById('closePreview').addEventListener('click', hideModal);
}

function showModal(){
  modalBackdrop.style.display = 'flex';
  modalBackdrop.setAttribute('aria-hidden','false');
}
function hideModal(){
  modalBackdrop.style.display = 'none';
  modalBackdrop.setAttribute('aria-hidden','true');
}

/* Cart logic */
function addToCart(noteId, qty=1){
  const note = state.notes.find(n=>n.id===noteId);
  if(!note) return;
  if(state.cart[noteId]){
    state.cart[noteId].qty += qty;
  } else {
    state.cart[noteId] = { id: note.id, title: note.title, price: note.price, qty };
  }
  saveLocal(); updateCartUI();
  flashCart();
}
cartBtn.addEventListener('click', ()=> {
  openCartDialog();
});
function openCartDialog(){
  modalTitle.textContent = 'Your Cart';
  let items = Object.values(state.cart);
  if(items.length === 0){
    previewArea.innerHTML = '<div class="center muted-2">Your cart is empty. Add notes to buy per-page or full bundles.</div>';
    showModal(); return;
  }
  let html = '<div style="display:flex;flex-direction:column;gap:8px">';
  items.forEach(it => {
    html += `<div style="display:flex;justify-content:space-between;align-items:center">
      <div><div style="font-weight:700">${it.title}</div><div class="muted-2">${it.qty} page(s) selected</div></div>
      <div style="text-align:right"><div>â‚¹ ${it.price * it.qty}</div><div style="display:flex;gap:6px;margin-top:6px"><button class="icon-btn" data-minus="${it.id}">-</button><button class="icon-btn" data-plus="${it.id}">+</button><button class="icon-btn" data-remove="${it.id}">âœ•</button></div></div>
    </div>`;
  });
  const total = items.reduce((s,i)=>s + i.price * i.qty,0);
  html += `<div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><div style="font-weight:800">Total</div><div style="font-weight:800">â‚¹ ${total}</div></div>`;
  html += `<div style="margin-top:12px;display:flex;gap:8px"><button class="btn" id="checkoutBtn">Checkout</button><button class="icon-btn" id="closeCart">Close</button></div></div>`;
  previewArea.innerHTML = html;
  showModal();

  previewArea.addEventListener('click', cartAction);
  function cartAction(e){
    const plus = e.target.closest('[data-plus]');
    const minus = e.target.closest('[data-minus]');
    const rem = e.target.closest('[data-remove]');
    if(plus){ state.cart[plus.dataset.plus].qty++; saveLocal(); renderCatalog(); openCartDialog(); }
    if(minus){ state.cart[minus.dataset.minus].qty = Math.max(1, state.cart[minus.dataset.minus].qty - 1); saveLocal(); renderCatalog(); openCartDialog(); }
    if(rem){ delete state.cart[rem.dataset.remove]; saveLocal(); renderCatalog(); openCartDialog(); }
  }

  document.getElementById('checkoutBtn').addEventListener('click', () => {
    const totalAmt = Object.values(state.cart).reduce((s,i)=>s + i.price * i.qty,0);
    if(state.wallet >= totalAmt){
      state.wallet -= totalAmt;
      state.cart = {};
      saveLocal(); updateWalletUI(); renderCatalog(); alert('Purchase successful. Notes added to your orders.');
      hideModal();
    } else {
      alert('Insufficient wallet balance. Add funds to proceed.');
    }
  });
  document.getElementById('closeCart').addEventListener('click', () => { previewArea.removeEventListener('click', cartAction); hideModal(); });
}

/* small UI bells */
function flashCart(){
  cartBtn.animate([{ transform: 'translateY(0) scale(1)'},{ transform: 'translateY(-6px) scale(1.04)'},{ transform: 'translateY(0) scale(1)'}], { duration:350, easing:'ease-out' });
}

/* Dark toggle (simple invert of background) */
const darkToggle = document.getElementById('darkToggle');
darkToggle.addEventListener('click', ()=> {
  state.dark = !state.dark;
  if(state.dark){
    document.documentElement.style.setProperty('--bg','#0f1724');
  } else {
    document.documentElement.style.setProperty('--bg','#f6f9fc');
    document.documentElement.style.setProperty('--card','rgba(10,20,30,0.03)');
    document.body.style.color = '#061826';
  }
});

/* Wallet actions */
document.getElementById('addFunds').addEventListener('click', ()=> {
  state.wallet += 100;
  saveLocal(); updateWalletUI();
  alert('â‚¹100 added to wallet (mock).');
});

/* Modal close handlers */
document.getElementById('modalClose').addEventListener('click', hideModal);
modalBackdrop.addEventListener('click', e => { if(e.target === modalBackdrop) hideModal(); });

/* Upload flows */
openUpload.addEventListener('click', ()=> {
  uploadBackdrop.style.display = 'flex';
  uploadBackdrop.setAttribute('aria-hidden','false');
});
uploadClose.addEventListener('click', ()=> {
  uploadBackdrop.style.display = 'none';
  uploadBackdrop.setAttribute('aria-hidden','true');
});
uploadBackdrop.addEventListener('click', e => { if(e.target === uploadBackdrop) { uploadBackdrop.style.display='none'; uploadBackdrop.setAttribute('aria-hidden','true'); } });
chooseFiles.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', handleFiles);

['dragenter','dragover'].forEach(evt => {
  dropArea.addEventListener(evt, e => { e.preventDefault(); dropArea.style.borderColor = 'rgba(124,58,237,0.6)'; });
});
['dragleave','drop'].forEach(evt => {
  dropArea.addEventListener(evt, e => { e.preventDefault(); dropArea.style.borderColor = 'rgba(255,255,255,0.04)'; });
});
dropArea.addEventListener('drop', e => {
  const files = Array.from(e.dataTransfer.files || []);
  handleFiles({ target: { files } });
});

function handleFiles(e){
  const files = Array.from(e.target.files || []);
  filePreview.innerHTML = '';
  files.slice(0,6).forEach(f => {
    const el = document.createElement('div');
    el.style.padding = '8px'; el.style.borderRadius = '8px'; el.style.background = 'rgba(255,255,255,0.02)'; el.style.minWidth='120px';
    el.innerHTML = `<div style="font-weight:700">${f.name}</div><div class="muted-2" style="font-size:12px">${Math.round(f.size/1024)} KB</div>`;
    filePreview.appendChild(el);

    // generate quick thumbnails for images
    if(f.type.startsWith('image/')){
      const reader = new FileReader();
      reader.onload = ev => {
        const img = document.createElement('img');
        img.src = ev.target.result; img.style.width='100%'; img.style.borderRadius='6px'; img.style.marginTop='8px';
        el.appendChild(img);
      }
      reader.readAsDataURL(f);
    }
    // for PDF - we show mock preview thumbnail
    if(f.type === 'application/pdf'){
      const p = document.createElement('div'); p.className='muted-2'; p.style.marginTop='8px'; p.textContent='PDF (preview will be generated server-side)';
      el.appendChild(p);
    }
  });
}

submitUpload.addEventListener('click', ()=> {
  const title = uploadTitle.value.trim() || 'Untitled notes';
  const course = uploadCourse.value;
  const price = Number(uploadPrice.value) || 10;
  // mock adding a note
  const newNote = { id: 'n' + (Math.random()*10000|0), title, course, pages: 8 + (Math.random()*40|0), price, rating:4.5, author:'You', date: new Date().toISOString(), thumbColor:'#7c3aed', description: 'Uploaded by you' };
  state.notes.unshift(newNote); saveLocal(); renderCatalog();
  uploadBackdrop.style.display='none'; uploadBackdrop.setAttribute('aria-hidden','true');
  alert('Notes uploaded (mock). In production, files must be sent to the server and previews generated.');
});
discardUpload.addEventListener('click', ()=> { filePreview.innerHTML=''; fileInput.value=''; uploadTitle.value=''; });

/* initialization */
updateWalletUI();
renderCatalog();

/* small accessibility: close modal on Esc */
document.addEventListener('keydown', e => {
  if(e.key === 'Escape'){
    hideModal();
    uploadBackdrop.style.display='none';
  }
});
</script>
</body>
</html>
